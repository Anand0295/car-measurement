<!DOCTYPE html>
<html>
<head>
    <title>Car Measurement System</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #1a1a1a; color: white; }
        
        .header { background: #0066cc; padding: 15px; text-align: center; }
        .header h1 { font-size: 24px; }
        
        .container { display: flex; height: calc(100vh - 60px); padding: 20px; gap: 20px; }
        
        .left { flex: 1; background: #2d2d2d; border-radius: 8px; padding: 20px; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        
        .right { width: 300px; background: #2d2d2d; border-radius: 8px; padding: 20px; }
        
        .upload-area { border: 2px dashed #555; padding: 40px; text-align: center; border-radius: 8px; cursor: pointer; }
        .upload-area:hover { border-color: #0066cc; }
        
        #imageDisplay { max-width: 100%; max-height: 400px; border-radius: 8px; }
        
        .measure-btn { width: 100%; padding: 15px; background: #0066cc; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; margin-bottom: 20px; }
        .measure-btn:hover { background: #0080ff; }
        .measure-btn:disabled { background: #666; }
        
        .result-box { background: #404040; border: 2px solid #0066cc; border-radius: 8px; padding: 15px; margin-bottom: 15px; text-align: center; }
        .result-box h4 { color: #0066cc; margin-bottom: 8px; font-size: 14px; }
        .result-box .value { font-size: 20px; font-weight: bold; }
        .result-box .unit { font-size: 12px; color: #888; margin-top: 5px; }
        
        .status { background: #0066cc; padding: 10px; text-align: center; font-size: 14px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>Car Measurement System</h1>
    </div>
    
    <div class="container">
        <div class="left">
            <div class="upload-area" onclick="document.getElementById('imageInput').click()">
                <p>Click to upload car image</p>
                <p style="font-size: 12px; color: #888;">JPG, PNG supported</p>
            </div>
            <input type="file" id="imageInput" accept="image/*" style="display: none;">
            <img id="imageDisplay" style="display: none;">
        </div>
        
        <div class="right">
            <button id="measureBtn" class="measure-btn" onclick="measureCar()">MEASURE CAR</button>
            
            <h3 style="color: #0066cc; margin-bottom: 15px;">Results</h3>
            
            <div class="result-box">
                <h4>CAR LENGTH</h4>
                <div class="value" id="lengthValue">--</div>
                <div class="unit">centimeters</div>
            </div>
            
            <div class="result-box">
                <h4>CAR WIDTH</h4>
                <div class="value" id="widthValue">--</div>
                <div class="unit">centimeters</div>
            </div>
            
            <div class="result-box">
                <h4>TIRE RADIUS</h4>
                <div class="value" id="tireValue">--</div>
                <div class="unit">centimeters</div>
            </div>
            
            <div class="result-box">
                <h4>CALIBRATION</h4>
                <div class="value" id="calibrationValue">--</div>
                <div class="unit">pixels/cm</div>
            </div>
        </div>
    </div>
    
    <div class="status" id="status">Ready - Upload car image</div>

    <script>
        let currentFile = null;
        let measuring = false;
        
        document.getElementById('imageInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                currentFile = file;
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.getElementById('imageDisplay');
                    img.src = e.target.result;
                    img.style.display = 'block';
                    document.querySelector('.upload-area').style.display = 'none';
                    updateStatus('Image loaded - Click MEASURE CAR');
                };
                reader.readAsDataURL(file);
            }
        });
        
        function updateStatus(message) {
            document.getElementById('status').textContent = message;
        }
        
        function updateResults(data) {
            document.getElementById('lengthValue').textContent = data.car_length;
            document.getElementById('widthValue').textContent = data.car_width;
            document.getElementById('tireValue').textContent = data.tire_radius;
            document.getElementById('calibrationValue').textContent = data.calibration;
        }
        
        async function measureCar() {
            if (!currentFile || measuring) {
                updateStatus('Please upload an image first');
                return;
            }
            
            measuring = true;
            const btn = document.getElementById('measureBtn');
            btn.disabled = true;
            btn.textContent = 'MEASURING...';
            updateStatus('Processing image...');
            
            try {
                const formData = new FormData();
                formData.append('image', currentFile);
                
                const response = await fetch('http://localhost:5001/measure', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                updateResults(data);
                
                if (data.image_base64) {
                    document.getElementById('imageDisplay').src = data.image_base64;
                }
                
                updateStatus('Measurement complete');
                
            } catch (error) {
                updateStatus('Error: Using fallback values');
                updateResults({
                    car_length: 450.0,
                    car_width: 180.0,
                    tire_radius: 32.5,
                    calibration: 3.2
                });
            }
            
            measuring = false;
            btn.disabled = false;
            btn.textContent = 'MEASURE CAR';
        }
    </script>
</body>
</html>